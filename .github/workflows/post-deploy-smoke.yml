name: Post-deploy A11y/Visual Smoke

on:
  workflow_dispatch:
    inputs:
      base_url:
        description: "Base URL to test (e.g., Netlify prod/preview)"
        default: "https://accessibilitysoftware.netlify.app"
        required: true

permissions:
  contents: read

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
      - name: Install deps
        run: npm ci
      - name: Run a11y/visual smoke (axe + Playwright)
        env:
          BASE_URL: ${{ inputs.base_url }}
          TAKE_SCREENSHOTS: "true"
          NEXT_PUBLIC_AUTH_ENABLED: "false" # allow preview routes without login
        run: npm --workspace apps/web run a11y:smoke
      - name: Upload screenshots
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-visual
          path: apps/web/playwright-visual
