# Milestone M4 – Student TTS & Database Foundation

This milestone establishes the core database schema and documents the Braille output prototype path used in the app.

## Database schema and configuration (optional data layer)

In the current `cs-poc` deployment, no relational database is configured and all durable storage is handled by Cloud Storage (attachments/exports) plus bundled sample JSON for API responses. The Prisma/PostgreSQL layer described here is the planned relational data model that can be enabled later by provisioning a database and setting `DATABASE_URL`.

- ORM: Prisma (`apps/web/prisma/schema.prisma`).
- Datasource: PostgreSQL via `DATABASE_URL`.
- Core models: `User`, `Course`, `Module`, `Note`, `Upload`, `Log` plus `UploadStatus` enum.
- Migrations: stored under `apps/web/prisma/migrations`. Generate/apply with:
  ```bash
  cd apps/web
  npx prisma migrate deploy   # in prod
  npx prisma migrate dev      # in dev (creates new migration)
  npx prisma generate         # refresh client
  ```
- Seeding: `node prisma/seed.cjs` (dev sample data) or `node scripts/seed-sample.js` (legacy).
- Environment: set `DATABASE_URL` (Postgres) only in environments where a relational database is provisioned, and keep it out of VCS/logs. Serverless frontends should use an API or connector-based approach, not direct DB from the browser.

## Braille path prototype

- Fallback Grade 1 mapper lives in `apps/web/lib/braille.ts`; server helper in `lib/brailleServer.ts`; API endpoint at `/api/braille`.
- Student dashboard shows Braille preview and `.brf` download. It prefers `liblouis` if `BRAILLE_ENGINE=liblouis` and `BRAILLE_LIBLOUIS_*` env vars are set; otherwise falls back to the built-in mapper.
- Configuration knobs (see `.env.local.example`):
  - `BRAILLE_ENGINE` (`liblouis` or `fallback`)
  - `BRAILLE_LIBLOUIS_BIN`, `BRAILLE_LIBLOUIS_TABLE`
- To validate Nemeth: run server with `BRAILLE_ENGINE=liblouis` and point to a liblouis binary/table; refresh the preview in the student dashboard. If unavailable, fallback remains active and noted in the UI.

## Deliverables status

- ✔ Prisma schema, migrations scaffold, and seed scripts.
- ✔ Documented DB config and migration commands.
- ✔ Braille prototype documented with env toggles and UI path. Ready for Beta validation; see `docs/ACCESSIBILITY.md` for posture.

